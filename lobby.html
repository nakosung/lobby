<head>
    <title>
        Lobby
    </title>
</head>

<body>
    <div class="navbar">
        <div class="navbar-inner">
            {{> navbar}}
        </div>
    </div>
    <div class="container">
        {{#if currentUser}}
            {{#if currentUser.name}}
                {{> main}}
            {{else}}
                {{> welcome}}
            {{/if}}
        {{else}}
            Login first
        {{/if}}
    </div>
</body>

<template name="welcome">
    <h4>What is your name?</h4>

    <form>
        <input type="text" class="name" id="name">
    </form>
</template>

<template name="navbar">
    <a class="brand" href="#" onclick="Router.navigate('/',{trigger:true});return false" >
        Lobby
    </a>
    {{#if currentUser}}
        <ul class="nav">
            <li>
                <a href="#">
                    {{#with currentUser._id}}
                    user:{{> profile_inline}}
                    {{/with}}
                </a>
            </li>
            <li>
                {{#if currentUser.clan}}
                <a href="#">
                    {{#with currentUser.clan}}
                    clan:{{> clan_inline}}
                    {{/with}}
                </a>
                {{else}}
                <button class="btn btn-small" id="createClan">Create a clan</button>
                {{/if}}
            </li>
            <li>
                <a href="#" onclick="Router.navigate('/Leaderboard',{trigger:true});return false">Leaderboard</a>
            </li>
        </ul>
    {{/if}}
    {{loginButtons}}
</template>

<template name="main">
    <div class="container">
        <div class="row">
            {{#if sessionGet 'clan'}}
            {{> clanHome}}
            {{else}}
            {{#if sessionGet 'user'}}
            {{> userHome}}
            {{/if}}
            {{/if}}
            {{#if sessionGet 'leaderboard'}}
            {{> leaderboard}}
            {{else}}
            {{#if game}}
            {{#with game}}
            {{> game}}
            {{/with}}
            {{else}}
            {{> lobby}}
            {{/if}}
            {{/if}}
        </div>
        <div class="row">
            {{> chat}}
        </div>
    </div>
</template>

<template name="chat">
    <h2>Chat</h2>
    <div style="height:100px;overflow:auto" class="chatWindow">
        {{#each chats}}
        <div>
            <strong>{{#with uid}}{{> profile_inline}}{{/with}}</strong> : {{text}}
        </div>
        {{/each}}
    </div>
    <form>
        <input type="text" class="search input" id="chatMsg">
    </form>
</template>

<template name="profile_inline">
    {{#with user}}
        <a href="#">{{name}}</a>
    {{/with}}
</template>

<template name="clan_inline">
    {{#with clan}}
        <a href="#">{{name}}</a>
    {{/with}}
</template>

<template name="clanHome">
    <div class="modal">
        {{#with clan}}
        <div class="modal-header">
            <h2>
                Clan: {{name}}
                <a href="javascript:Session.set('clan')" class="pull-right">&times;</a>
            </h2>
        </div>
        <div class="modal-body">
            <div class="btn-group">
                {{#if not currentUser.clan}}
                <button class="btn" id="joinClan">Join</button>
                {{/if}}
                {{#if eq currentUser.clan _id}}
                <button class="btn" id="leaveClan">Leave</button>
                {{/if}}
            </div>
            <dl>
                <dt>name</dt>
                <dd>{{name}}</dd>
                <dt>master</dt>
                <dd>{{#with master}}{{> profile_inline}}{{/with}}</dd>
                <dt>users</dt>
                <dd>
                    <ul>
                        {{#each users}}
                        <li>{{#with uid}}{{> profile_inline}}{{/with}}</li>
                        {{/each}}
                    </ul>
                </dd>
                <dt>board</dt>
                <dd>
                    {{#with _id}}
                    {{> board}}
                    {{/with}}
                </dd>
            </dl>
        </div>
        {{/with}}
    </div>
</template>

<template name="userHome">
    <div class="modal">
        {{#with user}}
            <div class="modal-header">
                <h2>
                    User: {{name}}
                    <a href="javascript:Session.set('user')" class="pull-right">&times;</a>
                </h2>
            </div>
            <div class="modal-body">
                <dl>
                    <dt>name</dt>
                    <dd>
                        {{name}}
                        {{#if eq currentUser._id _id}}
                        <button class="btn btn-small change">Change</button>
                        {{/if}}
                    </dd>
                    <dt>createdAt</dt>
                    <dd>{{moment createdAt}}</dd>
                    <dt>heartbeat</dt>
                    <dd>{{moment heartbeat}}</dd>
                    <dt>location</dt>
                    <dd>
                        {{#if game}}
                        <a href="javascript:Meteor.call('joinGame','{{game}}')">in game</a>
                        {{/if}}
                    </dd>
                    <dt>clan</dt>
                    <dd>
                        {{#if clan}}
                        {{#with clan}}{{> clan_inline}}{{/with}}
                        {{else}}
                        No clan yet
                        {{/if}}
                    </dd>
                    <dt>board</dt>
                    <dd>
                        {{#with _id}}
                        {{> board}}
                        {{/with}}
                    </dd>
                </dl>
            </div>
        {{/with}}
    </div>
</template>

<template name="board">
    {{#with board}}
    <h3>board</h3>
    <ul>
        {{#each articles}}
        <li>
            {{#with writer}}{{> profile_inline}}{{/with}} : {{text}}
            <span class="label">{{moment createdAt}}</span>
        </li>
        {{/each}}
    </ul>
    {{/with}}
    <form>
        <input type="text" id="boardText">
    </form>
</template>

<template name="leaderboard">
    <h2>Leaderboard</h2>
    <div class="span4">
        <h4>users</h4>
        <table>
            {{#each users}}
            <tr>
                <td>{{#with _id}}{{> profile_inline}}{{/with}}</td>
                <td>{{heartbeat}}</td>
            </tr>
            {{/each}}
        </table>
    </div>
</template>